{"version":3,"sources":["../../src/generators/package/index.js"],"names":["chalk","require","path","VulcanGenerator","common","module","exports","initializing","_assertIsVulcan","inputProps","prompting","_canPrompt","questions","_getPackageNameInputQuestion","type","name","message","messages","vulcanDependencies","choices","checked","when","prompt","then","answers","preProcessedDeps","props","packageName","_filterPackageName","map","dep","isPackageAutoAdd","_assertNotPackageExists","configuring","_canConfigure","_dispatch","_commitStore","_writePackageJs","fs","copyTpl","templatePath","_getPackagePath","isAbsolute","_writeClientMain","_getClientPath","_writeServerMain","_getServerPath","_writeServerSeed","_writeModulesIndex","_getModulesPath","_writeRoutes","_writeStoriesJs","_getPackageStoriesPath","_updateRootStoriesIndex","rootStoriesIndexPath","_getRootStoriesPath","packageStoriesPath","relativeTo","file","read","newFile","write","writing","_canWrite","end","_end","_hasNoErrors","log","green"],"mappings":"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","file":"index.js","sourcesContent":["const chalk = require('chalk');\nconst path = require('path');\nconst VulcanGenerator = require('../../lib/VulcanGenerator');\nconst common = require('../../lib/common');\n\nmodule.exports = class extends VulcanGenerator {\n\n  initializing () {\n    this._assertIsVulcan();\n    this.inputProps = {};\n  }\n\n  prompting () {\n    if (!this._canPrompt()) { return false; }\n    const questions = [\n      this._getPackageNameInputQuestion(),\n      {\n        type: 'checkbox',\n        name: 'vulcanDependencies',\n        message: common.messages.vulcanDependencies,\n        choices: [\n          { name: 'vulcan:core', checked: true },\n          'vulcan:posts',\n          'vulcan:comments',\n          'vulcan:newsletter',\n          'vulcan:notifications',\n          'vulcan:getting-started',\n          'vulcan:categories',\n          'vulcan:voting',\n          'vulcan:embedly',\n          'vulcan:api',\n          'vulcan:rss',\n          'vulcan:subscribe',\n        ],\n        when: () => (!this.inputProps.vulcanDependencies),\n      },\n      // this._getIsPackageAutoAddQuestion(),\n    ];\n\n    return this.prompt(questions).then((answers) => {\n      const preProcessedDeps =\n        this.inputProps.vulcanDependencies ||\n        answers.vulcanDependencies;\n      this.props = {\n        packageName: this._filterPackageName(this.inputProps.packageName || answers.packageName),\n        vulcanDependencies: preProcessedDeps.map((dep) => (`'${dep}'`)),\n        isPackageAutoAdd: this.inputProps.isPackageAutoAdd || answers.isPackageAutoAdd,\n      };\n      this._assertNotPackageExists(this.props.packageName);\n    });\n  }\n\n  configuring () {\n    if (!this._canConfigure()) { return; }\n    this._dispatch({\n      type: 'ADD_PACKAGE',\n      packageName: this.props.packageName,\n    });\n    this._commitStore();\n  }\n\n  _writePackageJs () {\n    this.fs.copyTpl(\n      this.templatePath('package.js'),\n      this._getPackagePath({ isAbsolute: true }, 'package.js'),\n      this.props\n    );\n  }\n\n  _writeClientMain () {\n    this.fs.copyTpl(\n      this.templatePath('client.js'),\n      this._getClientPath({ isAbsolute: true }, 'main.js'),\n      this.props\n    );\n  }\n\n  _writeServerMain () {\n    this.fs.copyTpl(\n      this.templatePath('server.js'),\n      this._getServerPath({ isAbsolute: true }, 'main.js'),\n      this.props\n    );\n  }\n\n  _writeServerSeed () {\n    this.fs.copyTpl(\n      this.templatePath('seed.js'),\n      this._getServerPath({ isAbsolute: true }, 'seed.js'),\n      this.props\n    );\n  }\n\n  _writeModulesIndex () {\n    this.fs.copyTpl(\n      this.templatePath('module.js'),\n      this._getModulesPath({ isAbsolute: true }, 'index.js'),\n      this.props\n    );\n  }\n\n  _writeRoutes () {\n    this.fs.copyTpl(\n      this.templatePath('routes.js'),\n      this._getModulesPath({ isAbsolute: true }, 'routes.js'),\n      this.props\n    );\n  }\n\n  _writeStoriesJs () {\n    this.fs.copyTpl(\n      this.templatePath('stories.js'),\n      this._getPackageStoriesPath({ isAbsolute: true }),\n      this.props\n    );\n  }\n\n  _updateRootStoriesIndex () {\n    const rootStoriesIndexPath = this._getRootStoriesPath(\n      { isAbsolute: true },\n      'index.js'\n    );\n    const packageStoriesPath = this._getPackageStoriesPath({\n      relativeTo: rootStoriesIndexPath,\n    });\n    const file = this.fs.read(rootStoriesIndexPath);\n    const newFile = `import '${packageStoriesPath}'; ${file}`;\n    this.fs.write(\n      rootStoriesIndexPath,\n      newFile\n    );\n  }\n\n  writing () {\n    if (!this._canWrite()) { return; }\n    this._writePackageJs();\n    this._writeClientMain();\n    this._writeServerMain();\n    this._writeServerSeed();\n    this._writeModulesIndex();\n    this._writeRoutes();\n    this._writeStoriesJs();\n    this._updateRootStoriesIndex();\n  }\n\n  end () {\n    this._end();\n    if (!this._hasNoErrors()) { return; }\n    this.log(`\\nTo activate your package, run: ${chalk.green(`meteor add ${this.props.packageName}`)}`);\n  }\n};\n"]}